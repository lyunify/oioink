{% load static %}
{% load lessons_tags %}

<!-- =================================== nav_in =========================================== -->

<nav class="navbar navbar-expand-lg navbar-light sticky-top shadow-sm border-bottom modern-navbar" style="padding: 0.75rem 0;">
    <div class="container-fluid px-4">
        <!-- Logo/Brand -->
        <a class="navbar-brand d-flex align-items-center me-4" href="{% url 'myhome:home' %}" style="font-weight: 700; font-size: 1.5rem; color: #6366f1;">
            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">oioink</span>
        </a>

        <!-- Mobile Toggle Button -->
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation" style="padding: 0.25rem 0.5rem;">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Content -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- Search Bar - Desktop -->
            <div class="d-none d-lg-flex align-items-center me-auto" style="max-width: 300px; flex: 1;">
                <form method="get" class="w-100 position-relative">
                    <input class="form-control form-control-sm rounded-pill ps-4" type="text" name="q" id="id_q" 
                           placeholder="Search..." style="border: 1px solid #e5e7eb; background-color: #f9fafb;">
                    <i class="bi bi-search position-absolute" style="left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; pointer-events: none;"></i>
                </form>
            </div>

            <!-- Navigation Links -->
            <ul class="navbar-nav d-flex align-items-center gap-2 mb-2 mb-lg-0 ms-lg-auto">
                <!-- Data Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="dataDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-database me-1"></i><span class="d-none d-xl-inline">Data</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="dataDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:file_upload' %}"><i class="bi bi-upload me-2"></i> File Upload</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:web_base_upload' %}"><i class="bi bi-globe me-2"></i> Web Content Upload</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:online_pdf_upload' %}"><i class="bi bi-file-pdf me-2"></i> Online PDF Upload</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:csv_upload' %}"><i class="bi bi-file-csv me-2"></i> CSV Upload</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:directory_upload' %}"><i class="bi bi-folder me-2"></i> Multiple File Upload</a></li>
                        <li><hr class="dropdown-divider my-2"></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:vector_db_list' %}"><i class="bi bi-list-ul me-2"></i> Vector DB List</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'data:llm_settings' %}"><i class="bi bi-gear me-2"></i> LLM Settings</a></li>
                    </ul>
                </li>

                <!-- ChatGPT Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="chatgptDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-chat-dots me-1"></i><span class="d-none d-xl-inline">ChatGPT</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="chatgptDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'chatgpt:get_chatgpt' %}"><i class="bi bi-chat-left-text me-2"></i> ChatGPT</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'chatgpt:chatgpt_list' %}"><i class="bi bi-list-ul me-2"></i> ChatGPT List</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'chatgpt:chatgpt_history' %}"><i class="bi bi-clock-history me-2"></i> ChatGPT History</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'chatgpt:export_chatgpt_history' %}"><i class="bi bi-download me-2"></i> Export History</a></li>
                    </ul>
                </li>

                <!-- Lessons Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="lessonsDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-book me-1"></i><span class="d-none d-xl-inline">Lessons</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="lessonsDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'lessons:lesson_list' %}"><i class="bi bi-list-ul me-2"></i> All Lessons</a></li>
                        <li><hr class="dropdown-divider my-2"></li>
                        {% get_all_lessons_for_menu as lessons_menu %}
                        {% for lesson in lessons_menu %}
                        <li>
                            <a class="dropdown-item dropdown-item-modern d-flex align-items-center" href="{% url 'lessons:lesson_detail' lesson.slug %}">
                                {% if lesson.icon %}
                                <span class="me-2" style="font-size: 1.1rem;">{{ lesson.icon|render_icon|safe }}</span>
                                {% else %}
                                <i class="bi bi-book me-2"></i>
                                {% endif %}
                                <span>Lesson {{ lesson.lesson_number }}: {{ lesson.title }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </li>

                <!-- Oinklog Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="trackingDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-journal-text me-1"></i><span class="d-none d-xl-inline">Oinklog</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="trackingDropdown">
                        <!-- Spending Submenu -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-item-modern dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-cash-stack me-2"></i> Spending
                            </a>
                            <ul class="dropdown-menu dropdown-menu-modern">
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:spending_list' %}"><i class="bi bi-list-ul me-2"></i> Spending List</a></li>
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:spending_create' %}"><i class="bi bi-plus-circle me-2"></i> Add Spending</a></li>
                                <li><hr class="dropdown-divider my-2"></li>
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:spending_dashboard' %}"><i class="bi bi-graph-up me-2"></i> Dashboard</a></li>
                            </ul>
                        </li>
                        <!-- Saving Submenu -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-item-modern dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-piggy-bank me-2"></i> Saving
                            </a>
                            <ul class="dropdown-menu dropdown-menu-modern">
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:saving_goal_list' %}"><i class="bi bi-bullseye me-2"></i> Saving Goals</a></li>
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:saving_list' %}"><i class="bi bi-list-ul me-2"></i> Saving List</a></li>
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:saving_create' %}"><i class="bi bi-plus-circle me-2"></i> Add Saving</a></li>
                                <li><hr class="dropdown-divider my-2"></li>
                                <li><a class="dropdown-item dropdown-item-modern" href="{% url 'tracking:saving_dashboard' %}"><i class="bi bi-graph-up me-2"></i> Dashboard</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>

                <!-- Wallet Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="walletDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-wallet2 me-1"></i><span class="d-none d-xl-inline">Wallet</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="walletDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'wallet:wallet_list' %}"><i class="bi bi-list-ul me-2"></i> Wallet List</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'wallet:wallet_create' %}"><i class="bi bi-plus-circle me-2"></i> Create Wallet</a></li>
                        <li><hr class="dropdown-divider my-2"></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'wallet:wallet_dashboard' %}"><i class="bi bi-graph-up me-2"></i> Dashboard</a></li>
                    </ul>
                </li>

                <!-- Dashboard -->
                <li class="nav-item">
                    <a class="nav-link modern-nav-link" href="{% url 'myhome:dashboard' %}" title="Dashboard">
                        <i class="bi bi-speedometer2 me-1"></i><span class="d-none d-xl-inline">Dashboard</span>
                    </a>
                </li>

                <!-- Achievements -->
                <li class="nav-item">
                    <a class="nav-link modern-nav-link" href="{% url 'achievements:achievement_list' %}" title="Achievements">
                        <i class="bi bi-trophy me-1"></i><span class="d-none d-xl-inline">Achievements</span>
                    </a>
                </li>

                <!-- Prizes Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link dropdown-toggle" href="#" id="prizesDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-gift me-1"></i><span class="d-none d-xl-inline">Prizes</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern dropdown-menu-end" aria-labelledby="prizesDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'prizes:prize_list' %}"><i class="bi bi-gift me-2"></i> Prize Shop</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'prizes:my_prizes' %}"><i class="bi bi-box-seam me-2"></i> My Prizes</a></li>
                    </ul>
                </li>

                <!-- User Profile Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link modern-nav-link d-flex align-items-center" href="#" id="userDropdown" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ user.profile.profile_image.url }}" class="rounded-circle me-2" 
                             style="width: 32px; height: 32px; object-fit: cover; border: 2px solid #e5e7eb;">
                        <span class="d-none d-lg-inline">{{ user.username }}</span>
                        <i class="bi bi-chevron-down ms-1 small"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-modern dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'accounts:account' %}"><i class="bi bi-person-circle me-2"></i> Account</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'accounts:profile' %}"><i class="bi bi-person me-2"></i> Profile</a></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'accounts:settings' %}"><i class="bi bi-gear me-2"></i> Settings</a></li>
                        <li><hr class="dropdown-divider my-2"></li>
                        <li><a class="dropdown-item dropdown-item-modern" href="{% url 'cal:calendar' %}"><i class="bi bi-calendar3 me-2"></i> Calendar</a></li>
                        <li><hr class="dropdown-divider my-2"></li>
                        <li><a class="dropdown-item dropdown-item-modern text-danger" href="{% url 'accounts:signout' %}"><i class="bi bi-box-arrow-right me-2"></i> Sign Out</a></li>
                    </ul>
                </li>

                <!-- Home Button -->
                <li class="nav-item">
                    <a class="btn btn-primary btn-sm rounded-pill px-3" href="{% url 'myhome:home' %}" style="font-weight: 500;">
                        <i class="bi bi-house me-1"></i><span class="d-none d-lg-inline">Home</span>
                    </a>
                </li>

                <!-- Search Bar - Mobile -->
                <li class="nav-item d-lg-none w-100 mt-2">
                    <form method="get" class="position-relative">
                        <input class="form-control form-control-sm rounded-pill ps-4" type="text" name="q" id="id_q_mobile" 
                               placeholder="Search..." style="border: 1px solid #e5e7eb; background-color: #f9fafb;">
                        <i class="bi bi-search position-absolute" style="left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; pointer-events: none;"></i>
                    </form>
                </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- =================================== nav_in end ======================================= -->